<!-- –û—á–∏—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è index.html –∏ —Å—Ç–∏–ª–µ–π: —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü -->
<!-- –ë—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: index.html, login.html, register.html, favorites.html, completions.html -->

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>üîç –ü–æ–∏—Å–∫ —Ñ—Ä–∏–ª–∞–Ω—Å-–∑–∞–∫–∞–∑–æ–≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body style="background: url('{{ background }}') no-repeat center center fixed; background-size: cover;">

<!-- –ú–µ–Ω—é -->
<button type="button" class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
<nav id="sideMenu" class="side-menu">
  <ul>
    <li><a href="/index">üè† –ì–ª–∞–≤–Ω–∞—è</a></li>
    <li><a href="/favorites">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã–µ</a></li>
    <li><a href="/my_tasks">üß∞ –ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</a></li>
    <li><a href="/completions">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ</a></li>
    <li><a href="/logout">üö™ –í—ã–π—Ç–∏</a></li>
  </ul>
</nav>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="main-content">
  <header>
    <h1 class="glow">üîç –ü–æ–∏—Å–∫ —Ñ—Ä–∏–ª–∞–Ω—Å-–∑–∞–∫–∞–∑–æ–≤</h1>
  </header>

  <form class="search-box" onsubmit="sendQuery(event)">
    <input type="text" id="query" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: AI 100" required>
    <button type="submit">–ù–∞–π—Ç–∏</button>
  </form>

  <p id="job-stats"></p>
  <div id="cards"></div>
</div>

<script>
function toggleMenu() {
  const menu = document.getElementById("sideMenu");
  menu.classList.toggle("open");
}


async function sendQuery(event) {
  event.preventDefault();
  const query = document.getElementById("query").value;
  const response = await fetch("/search", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query })
  });
  const jobs = await response.json();
  const cards = document.getElementById("cards");
  cards.innerHTML = jobs.map(job => `
    <div class="card">
      <h3>${job.title}</h3>
      <p><b>–ë—é–¥–∂–µ—Ç:</b> ${job.budget}</p>
      <p>${job.description.slice(0, 150)}...</p>
      <a href="${job.link}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
      <div class="card-buttons">
        <button class="card-button favorite" onclick="addToFavorites('${job.link}')">‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
        <a class="card-button take" href="/task/take/${job.id}">ü§ù –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É</a>
      </div>
    </div>
  `).join('');
}

async function addToFavorites(jobLink) {
  try {
    const res = await fetch("/add_to_favorites", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ job_id: jobLink })
    });
    const result = await res.json();
    alert(result.message || result.error);
  } catch (err) {
    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.");
    console.error(err);
  }
}
</script>


</body>
</html>
