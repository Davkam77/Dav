<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üë∑ –ú–æ–∏ –ó–∞–¥–∞–Ω–∏—è</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body style="background: url('{{ background }}') no-repeat center center fixed; background-size: cover;">
    <!-- –ö–Ω–æ–ø–∫–∞ –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é -->
    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>

    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <nav id="sideMenu" class="side-menu">
        <ul>
            <li><a href="/index">üè† –ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/favorites">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã–µ</a></li>
            <li><a href="/my_tasks">üß∞ –ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</a></li>
            <li><a href="/completions">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ</a></li>
            <li><a href="/logout">üö™ –í—ã–π—Ç–∏</a></li>
        </ul>
    </nav>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div id="toast-container"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="content-wrapper">
        <h2 class="glow">üë∑ –ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</h2>

        {% for task in tasks %}
<div class="task-card fade-in"> 
    <h3>{{ task.title }}</h3>
    <p>{{ task.description[:200] }}...</p>

    {% if task.link %}
        <a href="{{ task.link }}" target="_blank" class="task-link">üîó –ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–∫–∞–∑—É</a>
    {% endif %}

    <p class="task-status">
        <b>–°—Ç–∞—Ç—É—Å:</b>
        {% if task.status == 'in_progress' %}
            <span class="status-in-progress">–í —Ä–∞–±–æ—Ç–µ</span>
        {% elif task.status == 'done' %}
            <span class="status-done">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
        {% else %}
            <span class="status-unknown">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
        {% endif %}
    </p>

    {% if task.status == 'in_progress' %}
    <form action="/task/complete/{{ task.id }}" method="POST" style="display:inline;">
        <button type="submit" class="task-action complete">üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    </form>
    {% endif %}

    <p class="task-id">üìÖ –ó–∞–¥–∞–Ω–∏–µ ID: {{ task.id }}</p>
</div>
{% endfor %}


        <!-- AI –û–±—Ä–∞–±–æ—Ç–∫–∞ -->
        <div id="aiBlock" class="fade-in">
            <h2>ü¶ñ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞</h2>
            <textarea id="inputTextMyTasks" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏..."></textarea>
            <button onclick="simplifyMyTasks()">üîß –£–ø—Ä–æ—Å—Ç–∏—Ç—å</button>
            <div id="resultBlockMyTasks">
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                <div id="resultMyTasks">–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –∑–¥–µ—Å—å...</div>
                <button onclick="copyResultMyTasks()" class="copy-button">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ê—É–¥–∏–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <audio id="notificationSound" src="{{ url_for('static', filename='notification.mp3') }}" preload="auto"></audio>

    <!-- JavaScript -->
    <script>
        function toggleMenu() {
            const menu = document.getElementById("sideMenu");
            const toggle = document.querySelector(".menu-toggle");
            menu.classList.toggle("open");
            toggle.style.transform = menu.classList.contains("open") ? "rotate(90deg)" : "rotate(0deg)";
        }

        function showToast(message, type = "success") {
            const container = document.getElementById("toast-container");
            const toast = document.createElement("div");
            toast.className = `toast ${type}`;
            toast.innerText = message;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add("fade-out"), 3000);
            setTimeout(() => container.removeChild(toast), 4000);
            const sound = document.getElementById("notificationSound");
            if (sound) {
                sound.currentTime = 0;
                sound.play();
            }
        }

        async function simplifyMyTasks() {
            const text = document.getElementById("inputTextMyTasks").value.trim();
            if (!text) {
                showToast("‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏!", "error");
                return;
            }

            try {
                const res = await fetch("/simplify_api", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query: text })
                });
                const data = await res.json();

                if (Array.isArray(data) && data.length > 0) {
                    document.getElementById("resultMyTasks").innerText = data[0].description;
                    showToast("‚úÖ –¢–µ–∫—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω!");
                } else {
                    document.getElementById("resultMyTasks").innerText = "‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞.";
                    showToast("‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏!", "error");
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error);
                document.getElementById("resultMyTasks").innerText = "‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.";
                showToast("‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!", "error");
            }
        }

        function copyResultMyTasks() {
            const text = document.getElementById("resultMyTasks").innerText;
            navigator.clipboard.writeText(text).then(() => {
                showToast("‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
            }).catch(err => {
                console.error("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:", err);
                showToast("‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è!", "error");
            });
        }
    </script>
</body>
</html>